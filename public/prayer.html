<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayer Requests - Maryland Baptist Digital Ministry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="bg-gray-50">

    <header class="hero-gradient text-white relative">
        <div class="absolute top-0 right-0 p-6 z-20">
            <button id="mobile-menu-btn" class="md-hidden text-white">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 text-center">
            <nav class="header-nav pt-4 pb-10">
                <a href="/">Home</a>
                <a href="/pastor-aiden.html">Ask Pastor AIden</a>
                <a href="/devotional.html">Daily Devotional</a>
                <a href="/prayer.html" class="active">Prayer Requests</a>
                <a href="/about.html">About</a>
                <a href="/giving.html">Give</a>
            </nav>

            <div class="mb-8">
                <a href="/">
                    <img src="/assets/logo.svg" alt="Maryland Baptist Digital Ministry Logo" class="h-28 md:h-36 mx-auto brightness-0 invert">
                </a>
            </div>
            
            <h1 class="text-4xl md:text-5xl font-bold mb-3">Community Prayer</h1>
            <p class="text-lg md:text-xl text-gray-100 max-w-2xl mx-auto font-sans">"Therefore I tell you, whatever you ask in prayer, believe that you have received it, and it will be yours." - Mark 11:24</p>
        </div>
    </header>

    <div id="mobile-menu" class="hidden fixed inset-0 bg-primary-blue/95 backdrop-blur-md z-50 p-8 text-white">
        <button id="mobile-menu-close-btn" class="absolute top-6 right-6"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
        <div class="mt-16 flex flex-col items-center justify-center h-full space-y-6 text-2xl font-semibold">
            <a href="/" class="hover:text-accent-gold">Home</a>
            <a href="/pastor-aiden.html" class="hover:text-accent-gold">Ask Pastor AIden</a>
            <a href="/devotional.html" class="hover:text-accent-gold">Daily Devotional</a>
            <a href="/prayer.html" class="hover:text-accent-gold">Prayer Requests</a>
            <a href="/about.html" class="hover:text-accent-gold">About</a>
            <a href="/giving.html" class="hover:text-accent-gold">Give</a>
        </div>
    </div>

    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        
        <div class="bg-white rounded-xl shadow-lg p-8 md:p-12 mb-16">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 text-center">Share Your Prayer Request</h2>
            
            <div class="bg-yellow-50 border-l-4 border-accent-gold p-4 rounded-r-lg mb-8 font-sans">
                <div class="flex">
                    <div class="py-1"><svg class="fill-current h-6 w-6 text-yellow-500 mr-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zM9 5v6h2V5H9zm0 8h2v2H9v-2z"/></svg></div>
                    <div>
                        <p class="font-bold">Please Read Before Submitting</p>
                        <p class="text-sm">Prayer requests are displayed publicly after a brief review. For your privacy, please do not include last names, addresses, phone numbers, or any other sensitive personal information.</p>
                    </div>
                </div>
            </div>
            
            <form id="prayer-form" class="space-y-6 font-sans">
                <div>
                    <label for="name" class="block text-lg font-semibold text-gray-700 mb-2">First Name:</label>
                    <input type="text" id="first-name" name="first-name" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-gold focus:border-transparent text-lg" placeholder="John">
                </div>
                <div>
                    <label for="request" class="block text-lg font-semibold text-gray-700 mb-2">Your Prayer Request:</label>
                    <textarea id="request-text" name="request-text" rows="6" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-gold focus:border-transparent text-lg" placeholder="Please pray for..."></textarea>
                </div>
                <button type="submit" id="submit-button" class="w-full bg-primary-blue text-white font-bold py-4 px-8 rounded-lg text-lg hover:bg-blue-900 transition-colors shadow-lg">Submit for Review</button>
            </form>
            <div id="form-success" class="hidden mt-8 text-center bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-r-lg font-sans">
                <p class="font-bold">Thank You!</p>
                <p>Your prayer request has been submitted for review. It will appear on the prayer wall shortly if approved.</p>
            </div>
        </div>

        <section>
            <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Community Prayer Wall</h2>
            <div id="prayer-wall" class="space-y-6">
                <p id="loading-message" class="text-center text-gray-500 font-sans">Loading prayers...</p>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-white py-12 font-sans">
        </footer>

    <script>
        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenuCloseBtn = document.getElementById('mobile-menu-close-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuBtn.addEventListener('click', () => { mobileMenu.classList.remove('hidden'); });
        mobileMenuCloseBtn.addEventListener('click', () => { mobileMenu.classList.add('hidden'); });

        // -- PRAYER WALL LOGIC --
        const prayerForm = document.getElementById('prayer-form');
        const formSuccess = document.getElementById('form-success');
        const prayerWall = document.getElementById('prayer-wall');
        const loadingMessage = document.getElementById('loading-message');
        const submitButton = document.getElementById('submit-button');
        
        async function fetchPrayers() {
            try {
                const response = await fetch('/api/prayer');
                const prayers = await response.json();
                prayerWall.innerHTML = '';
                if (prayers.length === 0) {
                    prayerWall.innerHTML = '<p class="text-center text-gray-500 font-sans">No prayer requests at the moment. Be the first to share!</p>';
                } else {
                    prayers.forEach(prayer => {
                        const prayerEl = document.createElement('div');
                        prayerEl.className = 'bg-white rounded-lg shadow p-6 border-l-4 border-primary-blue';
                        prayerEl.innerHTML = `
                            <p class="text-gray-700 mb-3 font-serif text-lg">"${prayer.requestText}"</p>
                            <p class="text-right text-gray-500 font-sans text-sm">- ${prayer.firstName}</p>
                        `;
                        prayerWall.appendChild(prayerEl);
                    });
                }
            } catch (error) {
                console.error('Failed to fetch prayers:', error);
                prayerWall.innerHTML = '<p class="text-center text-red-500 font-sans">Could not load prayer requests. Please try again later.</p>';
            }
        }
        
        prayerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';
            
            const firstName = document.getElementById('first-name').value;
            // THIS LINE IS THE CRITICAL PART
            const requestText = document.getElementById('request-text').value;

            try {
                const response = await fetch('/api/prayer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ firstName, requestText }),
                });
                if (response.ok) {
                    formSuccess.classList.remove('hidden');
                    prayerForm.reset();
                    setTimeout(fetchPrayers, 2000);
                } else {
                    alert('An error occurred. Please try again.');
                }
            } catch (error) {
                console.error('Submission error:', error);
                alert('A network error occurred. Please try again.');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Submit for Review';
                setTimeout(() => { formSuccess.classList.add('hidden'); }, 5000);
            }
        });
        
        document.addEventListener('DOMContentLoaded', fetchPrayers);
    </script>
</body>
</html>